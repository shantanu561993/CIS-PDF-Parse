import re

def clean_data(headings,out):
    data = {"Title:":[],"Profile Applicability:":[],"Description:":[],"Rationale:":[],"Audit:":[],"Remediation:":[],"Impact:":[],"Default Value:":[],"References:":[]}
    for keys in headings:
        start,end = headings[keys]
        while start<end:
            temp = out[start]
            temp = temp.rstrip("\n")
            temp = temp.strip()
            if keys in temp:
                temp = temp.replace(keys,"")
            match = re.match( "(\d+ \| P a g e)",temp)
            if match:
                temp=temp.replace(match.group(),"")
            data[keys].append(temp)
            start+=1
    output_data(data)

def output_data(data):
    head = ["Title:","Profile Applicability:","Description:","Rationale:","Audit:","Remediation:","Impact:","Default Value:","References:"]
    g=open("output.csv","a")
    for item in head:
        #print item
        g.write(" ".join(data[item]))
        g.write("~")
    g.write("\r\n")
    g.close()
            


def find_data(out):
    heads = ["Title:","Profile Applicability:","Description:","Rationale:","Audit:","Remediation:","Impact:","Default Value:","References:"]
    headings = {"Title:":[0,0],"Profile Applicability:":[0,0],"Description:":[0,0],"Rationale:":[0,0],"Audit:":[0,0],"Remediation:":[0,0],"Impact:":[0,0],"Default Value:":[0,0],"References:":[0,0]}
    start = 0
    notfound = []
    for head in heads:
        start = 0
        for line in out:
            if head in line:
                headings[head][0] = start
                indexofhead = heads.index(head)
                indexofhead = indexofhead - 1
                headings[heads[indexofhead]][1]=start
            start+=1
    headings[head][1]=len(out)
                    
#    for line in out:
#        for item in head:
#            if item in line:
#                headings[item][0]=start
#                index = head.index(item)
#                index = index-1
#                headings[head[index]][1]=start
#                print "setting",item,start
#        start +=1
#    headings[item][1]=len(out)
#    print headings


    clean_data(headings,out)
             
        
        
def get_data(data,start,end):
    count = 0
    out=[]
    for line in data:
        if start in line and line.startswith(start):
            match  = re.match(start+"\s+",line)
            if match:
                break
        count +=1

    start_data = count 
    while True:
        out.append(data[start_data])
        start_data +=1
        if end in data[start_data]:
            break

    find_data(out)


data=open("all_text.txt","r").readlines()
index = ["1.1.1.1.1.1", "1.1.1.1.1.2", "1.1.1.1.1.3", "1.1.1.1.1.4", "1.1.1.1.1.5", "1.1.1.1.1.6", "1.1.1.1.1.7", "1.1.1.1.1.8", "1.1.1.1.1.9", "1.1.1.1.1.10", "1.1.1.1.1.11", "1.1.1.1.1.12", "1.1.1.1.1.13", "1.1.1.1.1.14", "1.1.1.1.1.15", "1.1.1.1.1.16", "1.1.1.1.1.17", "1.1.1.1.1.18", "1.1.1.1.1.19", "1.1.1.1.1.20", "1.1.1.1.1.21", "1.1.1.1.1.22", "1.1.1.1.1.23", "1.1.1.1.1.24", "1.1.1.1.1.25", "1.1.1.1.1.26", "1.1.1.1.1.27", "1.1.1.1.1.28", "1.1.1.1.1.29", "1.1.1.1.1.30", "1.1.1.1.1.31", "1.1.1.1.1.32", "1.1.1.1.1.33", "1.1.1.1.1.34", "1.1.1.1.1.35", "1.1.1.1.1.36", "1.1.1.1.1.37", "1.1.1.1.2.1", "1.1.1.1.2.2", "1.1.1.1.2.3", "1.1.1.1.2.4", "1.1.1.1.2.5", "1.1.1.1.2.6", "1.1.1.1.2.7", "1.1.1.1.2.8", "1.1.1.1.2.9", "1.1.1.1.2.10", "1.1.1.1.2.11", "1.1.1.1.2.12", "1.1.1.1.2.13", "1.1.1.1.2.14", "1.1.1.1.2.15", "1.1.1.1.2.16", "1.1.1.1.2.17", "1.1.1.1.2.18", "1.1.1.1.2.19", "1.1.1.1.2.20", "1.1.1.1.2.21", "1.1.1.1.2.22", "1.1.1.1.2.23", "1.1.1.1.2.24", "1.1.1.1.2.25", "1.1.1.1.2.26", "1.1.1.1.2.27", "1.1.1.1.2.28", "1.1.1.1.2.29", "1.1.1.1.2.30","1.1.1.1.2.31", "1.1.1.1.2.32", "1.1.1.1.2.33", "1.1.1.1.2.34", "1.1.1.1.2.35", "1.1.1.1.2.36", "1.1.1.1.2.37", "1.1.1.1.2.38", "1.1.1.1.2.39", "1.1.1.1.2.40", "1.1.1.1.2.41", "1.1.1.1.2.42", "1.1.1.1.2.43", "1.1.1.1.2.44", "1.1.1.1.2.45", "1.1.1.1.2.46", "1.1.1.1.2.47", "1.1.1.1.2.48", "1.1.1.1.2.49", "1.1.1.1.2.50", "1.1.1.1.2.51", "1.1.1.1.2.52", "1.1.1.1.2.53", "1.1.1.1.2.54", "1.1.1.1.2.55", "1.1.1.1.2.56", "1.1.1.1.2.57", "1.1.1.1.2.58", "1.1.1.1.2.59", "1.1.1.1.2.60", "1.1.1.1.2.61", "1.1.1.1.2.62", "1.1.1.1.2.63", "1.1.1.1.2.64", "1.1.1.1.2.65", "1.1.1.1.2.66", "1.1.1.1.2.67", "1.1.1.1.2.68", "1.1.1.1.3.1", "1.1.1.1.3.2", "1.1.1.1.3.3", "1.1.1.1.3.4", "1.1.1.1.3.5", "1.1.1.1.3.6", "1.1.1.1.3.7", "1.1.1.1.3.8", "1.1.1.1.3.9", "1.1.1.2.1", "1.1.1.2.2", "1.1.1.2.3", "1.1.1.2.4", "1.1.1.2.5", "1.1.1.2.6", "1.1.1.2.7", "1.1.1.2.8", "1.1.1.2.9", "1.1.1.2.10", "1.1.1.2.11", "1.1.1.2.12", "1.1.1.3.1", "1.1.1.3.2", "1.1.1.3.3", "1.1.1.3.4", "1.1.1.3.5", "1.1.1.3.6", "1.1.1.3.7", "1.1.1.3.8", "1.1.1.3.9", "1.1.1.3.10", "1.1.1.3.11", "1.1.1.3.12", "1.1.1.3.13", "1.1.1.3.14", "1.1.1.3.15", "1.1.1.3.16", "1.1.1.3.17", "1.1.1.3.18", "1.1.1.3.19", "1.1.1.3.20", "1.1.1.3.21", "1.1.1.3.22", "1.1.1.3.23", "1.1.1.3.24", "1.1.1.3.25", "1.1.1.3.26", "1.1.1.3.27", "1.1.1.3.28", "1.1.1.3.29", "1.1.1.3.30", "1.1.1.3.31", "1.1.1.3.32", "1.1.1.3.33", "1.1.1.3.34", "1.1.1.3.35", "1.1.1.3.36", "1.1.1.3.37", "1.1.1.3.38", "1.1.1.3.39", "1.1.1.3.40", "1.1.1.3.41", "1.1.1.3.42", "1.1.1.4.1.1", "1.1.1.4.1.2", "1.1.1.4.1.3", "1.1.1.4.1.4", "1.1.1.4.1.5", "1.1.1.4.1.6", "1.1.1.4.2.1", "1.1.1.4.2.2", "1.1.1.4.2.3", "1.2.1.1.1.1.1", "1.2.1.1.1.1.2", "1.2.1.1.1.1.3", "1.2.1.1.1.1.4", "1.2.1.1.1.1.5", "1.2.1.1.1.1.6", "1.2.1.1.1.1.7", "1.2.1.1.1.1.8", "1.2.1.1.1.1.9", "1.2.1.1.1.1.10", "1.2.1.1.1.1.11", "1.2.1.1.1.1.12", "1.2.1.1.1.1.13", "1.2.1.1.1.2.1", "1.2.1.1.1.2.2", "1.2.1.1.1.2.3", "1.2.1.1.1.2.4", "1.2.1.1.1.2.5", "1.2.1.1.1.2.6", "1.2.1.1.1.2.7", "1.2.1.1.1.2.8", "1.2.1.1.1.2.9", "1.2.1.1.1.2.10", "1.2.1.1.1.2.11", "1.2.1.1.1.2.12", "1.2.1.1.1.2.13", "1.2.2.1.1", "1.2.2.1.2", "1.2.2.2.1", "1.2.2.2.2", "1.2.2.2.3", "1.2.2.3.1", "1.2.2.3.2", "1.2.2.4.1.1", "1.2.2.4.1.2", "1.2.2.4.1.3", "1.2.2.4.1.4", "1.2.2.4.1.5", "1.2.2.4.1.6", "1.2.2.4.1.7", "1.2.2.5.1", "1.2.2.5.2", "1.2.3.1.1", "1.2.3.1.2", "1.2.3.1.3", "1.2.3.1.4", "1.2.3.1.5", "1.2.3.1.6", "1.2.3.1.7", "1.2.3.1.8", "1.2.3.2.1", "1.2.3.3.1.1", "1.2.3.3.2.1.1", "1.2.3.3.2.2.1", "1.2.3.3.2.3.1", "1.2.3.3.2.3.2", "1.2.3.4.1", "1.2.3.5.1.1", "1.2.3.5.2", "1.2.3.6.1", "1.2.3.7.1", "2.1.1.1.1", "2.1.1.2", "2.1.2.1.1", "2.1.2.1.2", "2.1.2.2.1", "2.1.2.2.2", "2.1.2.2.3", "2.1.3.1.1", "2.1.3.1.2", "2.1.3.1.3", "2.1.3.1.4"]
#index = ["1.2.3.3.2.3.1","1.2.3.3.2.3.2"]
g=open("output.csv","w")
g.close()
for item in index:
    start = item
    try:
        end = index[index.index(start)+1]
        print start,end
        get_data(data,start,end)
    except IndexError:
        break
    

